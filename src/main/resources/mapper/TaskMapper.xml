<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ols.ols_project.mapper.TaskMapper">
    <select id="getImageListByTaskId" resultType="java.lang.String">
        select url from ols_task where id = #{taskId}
    </select>

    <select id="getAccepteImageListByAccepteId" resultType="com.ols.ols_project.model.AcceptTask">
        select
           ols_task.id as ols_task_id,
           name,
           ols_task.url as ols_task_url,
           information,
           points,
           ols_task.state as ols_task_state,
           type,
           ols_task.finish_time as ols_task_finish_time,
           release_time,
           release_user_id,
           accept_num,
           adopt_accept_id,
           ols_accept.id as ols_accept_id,
           user_id,
           accept_time,
           ols_accept.finish_time as ols_accept_finish_time,
           ols_accept.state as ols_accept_stat,
           ols_accept.url as ols_accept_url
        from
          ols_task,ols_accept
        where
          ols_task.type=1
          and ols_task.id = ols_accept.task_id
          and ols_accept.id = #{acceptId}
    </select>

    <select id="getAccepteTaskInfoByAcceptId" resultType="com.ols.ols_project.model.AccepteEntity">
        select
          id,
          user_id,
          task_id,
          accept_time,
          finish_time,
          state,
          url,
          ext1,
          ext2,
          ext3
        from
          ols_accept
        where
          id=#{acceptId}
    </select>

    <update id="storeImageLabelInfoByAccepteId">
      update
        ols_accept
      set
        url=#{url}
      where
        id=#{acceptId}
    </update>

    <select id="getNotCheckedTask" resultMap="TaskMap">
        SELECT
            id,
            name,
            url,
            information,
            points,
            state,
            type,
            release_time,
            finish_time,
            release_user_id,
            accept_num,
            adopt_accept_id,
            ext1,
            ext2,
            ext3
        from
            ols_task
        where
            ext2 like '${userId}'
            and state = 4
    </select>

    <update id="setNotCheckedTaskForUser">
        update
          ols_task
        set
          ext2 = '${userId}'
        where
          state = 4
          and ext2 is null
        limit
          #{count}
    </update>

    <select id="getTaskInfoByTaskId" resultType="com.ols.ols_project.model.TaskEntity">
        select
          id,
          name,
          url,
          information,
          points,
          state,
          type,
          release_time,
          finish_time,
          release_user_id,
          accept_num,
          adopt_accept_id,
          ext1,
          ext2,
          ext3
        from
          ols_task
        where
          id = #{taskId}
    </select>

    <insert id="insAcceptTask" parameterType="com.ols.ols_project.model.AccepteEntity">
        insert into ols_accept
          (
            user_id,
            task_id,
            accept_time,
            finish_time,
            state,
            url,
            ext1,
            ext2,
            ext3
          )
        values
          (
            #{user_id},
            #{task_id},
            #{accept_time},
            #{finish_time},
            #{state},
            #{url},
            #{ext1},
            #{ext2},
            #{ext3}
          )
    </insert>

    <select id="selAcceptNumOfTask" resultType="int">
        select
          accept_num
        from
          ols_task
        where
          id=#{taskId}
    </select>

    <update id="updAcceptNumOfTask">
        update
          ols_task
        set
          accept_num=#{acceptNum}
        where
          id=#{taskId}
    </update>

    <resultMap id="TaskMap" type="com.ols.ols_project.model.TaskEntity" >
        <id column="id" property="id"  />
        <result column="name" property="name" />
        <result column="url" property="url" />
        <result column="information" property="information" />
        <result column="points" property="points" />
        <result column="state" property="state" />
        <result column="type" property="type" />
        <result column="release_time" property="release_time" />
        <result column="finish_time" property="finish_time" />
        <result column="release_user_id" property="release_user_id" />
        <result column="accept_num" property="accept_num" />
        <result column="adopt_accept_id" property="adopt_accept_id" />
        <result column="ext1" property="ext1" />
        <result column="ext2" property="ext2" />
        <result column="ext3" property="ext3" />
    </resultMap>

    <resultMap id="total" type="java.lang.Integer">
        <result column="total"/>
    </resultMap>
</mapper>